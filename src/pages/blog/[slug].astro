---
import MainLayout from '../../layouts/main.astro';
import Post from "../../layouts/Post.astro"
import SideNav from "../SideNav.astro"

import { getCollection, getEntry } from "astro:content";

// Required for static builds - tells Astro which pages to generate 
export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => {
        // post.id might be "1.kwin-project-week-1-2/index"
        // Extract just the folder name
        const slug = post.id.split('/')[0];  // Astro 5.x uses 'id' not 'slug'
        console.log(slug);
        return { 
            params: { slug },
            props: { post },  // Pass the post as a prop to avoid fetching again
        };
    });
}

// Get the slug from URL params 
const { slug } = Astro.params;  // Fetch the entry using Astro 5.x API (not getEntryBySlug) 
const { post } = Astro.props;  // Handle case where post doesn't exist 

if (!post) {
    return Astro.redirect("/404"); 
}

// Render the markdown content 
const { Content } = await post.render();

const props = Astro.props;
const title = props.title;
---
<MainLayout title= {`Yorisoft - ${post.data.title}`}>
    <SideNav slot="side-panel" />
    <Post slot="main" >
        <p slot="blog-title">{post.data.title}</p>
        <Content slot="blog" />
    </Post> 
</MainLayout>
